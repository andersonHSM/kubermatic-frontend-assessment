<p-dialog
        header="Edit cluster"
        [modal]="true"
        [(visible)]="visible"
        styleClass="w-2xl min-h-25"
        (onHide)="onHide()"
>
    <ng-template #header>
        <div class="flex flex-col gap-2">
            <h3 class="text-3xl">Edit cluster</h3>
        </div>
    </ng-template>

    <p-stepper
            [(value)]="currentStep"
            class="w-full p-2"
    >
        <p-step-list>
            <p-step [value]="1">Basic</p-step>
            <p-step [value]="2">Details</p-step>
            <p-step [value]="3">Confirmation</p-step>
        </p-step-list>
        <p-step-panels>
            <p-step-panel [value]="1">
                <ng-template
					#content
					let-activateCallback="activateCallback"
                >
                    <form [formGroup]="clusterForm">
                        <div class="flex flex-col gap-2 px-5">
                            <div class="grid grid-cols-2 auto-rows-auto min-h-10 gap-8 py-5">
                                <div
                                        class="w-full"
                                >
                                    <label for="cluster-name">Name</label>
                                    <input
                                            id="cluster-name"
                                            autocomplete="off"
                                            pInputText
                                            class="w-full"
                                            formControlName="name"
                                    />
                                </div>
                                <div
                                        class="w-full"
                                >
                                    <label for="cluster-version">Version</label>
                                    <p-auto-complete
                                            appendTo="body"
                                            optionLabel="version"
                                            optionValue="version"
                                            inputId="cluster-version"
                                            dropdown
                                            [ngModelOptions]="{standalone: true}"
                                            [(ngModel)]="searchVersionModel"
                                            (onSelect)="onVersionChange($event)"
                                            (completeMethod)="searchVersion($event)"
                                            [suggestions]="filteredVersions"
                                    ></p-auto-complete>
                                </div>
                                <div
                                        class="w-full"
                                >
                                    <label for="cluster-region mb-10">Region</label>
                                    <p-auto-complete
                                            appendTo="body"
                                            optionLabel="code"
                                            optionValue="code"
                                            dropdown
                                            inputId="cluster-region"
                                            [ngModelOptions]="{standalone: true}"
                                            [(ngModel)]="searchRegionModel"
                                            (onSelect)="onRegionChange($event)"
                                            (completeMethod)="searchRegion($event)"
                                            [suggestions]="filteredRegions"
                                    ></p-auto-complete>
                                </div>
                            </div>

                            <div class="flex pt-6 justify-end">
                                <p-button
                                        label="Next"
                                        icon="pi pi-arrow-right"
                                        iconPos="right"
                                        (onClick)="activateCallback(2)"
                                />
                            </div>
                        </div>
                    </form>
                </ng-template>
            </p-step-panel>
            <p-step-panel [value]="2">
                <ng-template
					#content
					let-activateCallback="activateCallback"
                >
                    <form
                            [formGroup]="clusterForm"
                            class="flex flex-col gap-4 p-4"
                    >
                        <div class="flex flex-col gap-4">
                            <p class="text-sm -mb-3">Node Count</p>
                            <p-input-group class="gap-0.5 w-fit!">
                                <p-button
                                        icon="pi pi-minus"
                                        (click)="decreaseNodeCount()"
                                />
                                <input
                                        id="cluster-node-count"
                                        ngDefaultControl
                                        type="text"
                                        pInputText
                                        formControlName="nodeCount"
                                        class="w-fit mb-4 c"
                                />
                                <p-button
                                        icon="pi pi-plus"
                                        (click)="increaseNodeCount()"
                                />
                            </p-input-group>
                            <p-slider
                                    [ngModel]="clusterForm.controls.nodeCount.value"
                                    (ngModelChange)="clusterForm.controls.nodeCount.setValue($event)"
                                    [ngModelOptions]="{standalone: true}"
                                    class="w-full"
                            />
                        </div>
                        <div class="flex flex-col gap-4">
                            <p class="text-sm">Labels</p>
                            <div class="grid grid-rows-2 gap-2">
                                <div
                                        class="grid grid-cols-2 gap-2"
                                        formGroupName="labelInput"
                                >
                                    <p-float-label
                                            class="w-full"
                                            variant="over"
                                    >
                                        <label for="cluster-labels">Key</label>
                                        <input
											#key
                                            class="w-full"
                                            pInputText
                                            id="cluster-labels"
                                            formControlName="key"
                                        />
                                    </p-float-label>
                                    <p-float-label
                                            class="w-full"
                                            variant="over"
                                    >
                                        <label for="cluster-labels">Value</label>
                                        <input
											#value
                                            class="w-full"
                                            pInputText
                                            id="cluster-labels"
                                            formControlName="value"
                                        />
                                    </p-float-label>
                                </div>
                                <p-button
                                        (click)="addLabel(key.value, value.value)"
                                        [disabled]="!key.value || !value.value"
                                        class="ml-auto"
                                        label="Add label"
                                        icon="pi pi-plus"
                                        iconPos="right"
                                />
                            </div>
                            <div
                                    class="flex gap-4"
                                    formArrayName="labels"
                            >
                                @for (label of labels.controls; track
									`${label.value['key']}:${label.value['value']}`) {
                                    @if (label && label.value['key']
									&& label.value['value']) {
                                        <p-tag
                                                class="cursor-pointer"
                                                (click)="removeLabel($index)"
                                                severity="secondary"
                                                value="{{ label.value['key'] ?? '' }}:{{ label.value['value'] ?? '' }}"
                                        />
                                    }
                                }
                            </div>
                        </div>
                        <div class="flex pt-6 justify-between">
                            <p-button
                                    severity="contrast"
                                    label="Back"
                                    icon="pi pi-arrow-left"
                                    iconPos="left"
                                    (onClick)="activateCallback(1)"
                            />
                            <p-button
                                    label="Next"
                                    icon="pi pi-arrow-right"
                                    iconPos="right"
                                    (onClick)="activateCallback(3)"
                            />
                        </div>
                    </form>
                </ng-template>
            </p-step-panel>
            <p-step-panel [value]="3">
                <ng-template #content let-activateCallback="activateCallback">
                    <div
                            class="rounded-lg p-4 grid grid-cols-2 grid-rows-2 gap-4 bg-gray-300 dark:bg-gray-800"
                    >
                        <div class="flex flex-col gap-0.5">
                            <div>
                                <i class="pi pi-server text-4xl mr-2"></i>
                                <span class="font-bold">Cluster name</span>
                            </div>
                            <span class="pl-2">{{ this.clusterForm.controls.name.value }}</span>
                        </div>
                        <div class="flex flex-col gap-0.5">
                            <div>
                                <i class="pi pi-map-marker text-4xl mr-2"></i>
                                <span class="font-bold">Region</span>
                            </div>
                            <span class="pl-2">{{ this.selectedRegion()?.name }}</span>
                            <span class="pl-2">{{ this.selectedRegion()?.code }}</span>
                        </div>
                        <div class="flex flex-col gap-0.5">
                            <div>
                                <i class="pi pi-box text-4xl mr-2"></i>
                                <span class="font-bold">Kubernetes version</span>
                            </div>
                            <span class="pl-2">v{{ this.clusterForm.controls.version.value }}</span>
                        </div>
                    </div>
                    <div
                            class="rounded-lg mt-2 p-4 grid grid-cols-2 grid-rows-2 gap-4 bg-gray-300 dark:bg-gray-800"
                    >
                        <div class="flex flex-col gap-0.5">
                            <div>
                                <i class="pi pi-tags text-4xl mr-2"></i>
                                <span class="font-bold">Labels</span>
                            </div>
                            <div class="flex gap-2">
                                @for (label of labels.controls.values(); track
									`${label.value['key']}:${label.value['value']}`) {
                                    @if (label && label.value['key']
									&& label.value['value']) {
                                        <p-tag
                                                severity="secondary"
                                                value="{{ label.value['key'] ?? '' }}:{{ label.value['value'] ?? '' }}"
                                        />
                                    }
                                }
                            </div>
                        </div>
                    </div>
                    <div class="mt-2 flex justify-between">
                        <p-button
                                severity="contrast"
                                label="Back"
                                icon="pi pi-arrow-left"
                                iconPos="left"
                                (onClick)="activateCallback(2)"
                        />
                        <p-button
                                label="Confirm"
                                icon="pi pi-check"
                                iconPos="right"
                                (onClick)="saveCluster()"
                        />
                    </div>
                </ng-template>
            </p-step-panel>
        </p-step-panels>
    </p-stepper>
</p-dialog>
