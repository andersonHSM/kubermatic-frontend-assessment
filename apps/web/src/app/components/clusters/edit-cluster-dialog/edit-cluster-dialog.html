<p-dialog
        header="Edit cluster"
        [modal]="true"
        [(visible)]="visible"
        styleClass="w-2xl min-h-25"
        (onHide)="onHide()"
>
    <ng-template #header>
        <div class="flex flex-col gap-2">
            <h3 class="text-3xl">Edit cluster</h3>
        </div>
    </ng-template>

    <p-stepper
            [(value)]="currentStep"
            class="w-full p-2"
    >
        <p-step-list>
            <p-step [value]="1">Basic</p-step>
            <p-step [value]="2">Details</p-step>
            <p-step [value]="3">Confirmation</p-step>
        </p-step-list>
        <p-step-panels>
            <p-step-panel [value]="1" class="h-40">
                <ng-template
					#content
					let-activateCallback="activateCallback"
                >
                    <form [formGroup]="clusterForm">
                        <div class="flex flex-col gap-2 px-5">
                            <div class="grid grid-cols-2 min-h-10 gap-3 py-2">
                                <p-float-label
                                        class="w-full"
                                        variant="on"
                                >
                                    <label for="cluster-name">Name</label>
                                    <input
                                            id="cluster-name"
                                            autocomplete="off"
                                            pInputText
                                            class="w-full"
                                            formControlName="name"
                                    />
                                </p-float-label>
                                <p-float-label
                                        class="w-full"
                                        variant="on"
                                >
                                    <label for="cluster-version">Version</label>
                                    <!-- todo: implement version listing-->
                                    <p-auto-complete
                                            optionLabel="version"
                                            optionValue="version"
                                            dropdown
                                            inputId="cluster-version"
                                            [ngModelOptions]="{standalone: true}"
                                            [(ngModel)]="searchVersionModel"
                                            (completeMethod)="searchVersion($event)"
                                            [suggestions]="filteredVersions"
                                    ></p-auto-complete>
                                </p-float-label>
                            </div>

                            <div class="flex pt-6 justify-end">
                                <p-button
                                        label="Next"
                                        icon="pi pi-arrow-right"
                                        iconPos="right"
                                        (onClick)="activateCallback(2)"
                                />
                            </div>
                        </div>
                    </form>
                </ng-template>
            </p-step-panel>
            <p-step-panel [value]="2">
                <ng-template
					#content
					let-activateCallback="activateCallback"
                >
                    <form
                            [formGroup]="clusterForm"
                            class="flex flex-col gap-4 p-4"
                    >
                        <div class="flex flex-col gap-4">
                            <p class="text-sm -mb-3">Node Count</p>
                            <p-input-group class="gap-0.5 w-fit!">
                                <p-button
                                        icon="pi pi-minus"
                                        (click)="decreaseNodeCount()"
                                />
                                <input
                                        id="cluster-node-count"
                                        ngDefaultControl
                                        type="text"
                                        pInputText
                                        formControlName="nodeCount"
                                        class="w-fit mb-4 c"
                                />
                                <p-button
                                        icon="pi pi-plus"
                                        (click)="increaseNodeCount()"
                                />
                            </p-input-group>
                            <p-slider
                                    [ngModel]="clusterForm.controls.nodeCount.value"
                                    (ngModelChange)="clusterForm.controls.nodeCount.setValue($event)"
                                    [ngModelOptions]="{standalone: true}"
                                    class="w-full"
                            />
                        </div>
                        <div class="flex flex-col gap-4">
                            <p class="text-sm">Labels</p>
                            <div class="grid grid-rows-2 gap-2">
                                <div
                                        class="grid grid-cols-2 gap-2"
                                        formGroupName="labelInput"
                                >
                                    <p-float-label
                                            class="w-full"
                                            variant="on"
                                    >
                                        <label for="cluster-labels">Key</label>
                                        <input
											#key
                                            class="w-full"
                                            pInputText
                                            id="cluster-labels"
                                            formControlName="key"
                                        />
                                    </p-float-label>
                                    <p-float-label
                                            class="w-full"
                                            variant="on"
                                    >
                                        <label for="cluster-labels">Value</label>
                                        <input
											#value
                                            class="w-full"
                                            pInputText
                                            id="cluster-labels"
                                            formControlName="value"
                                        />
                                    </p-float-label>
                                </div>
                                <p-button
                                        (click)="addLabel(key.value, value.value)"
                                        class="ml-auto"
                                        label="Add label"
                                        icon="pi pi-plus"
                                        iconPos="right"
                                />
                            </div>
                            <div
                                    class="flex gap-4"
                                    formArrayName="labels"
                            >
                                @for (label of labels.controls; track
									`${label.value['key']}:${label.value['value']}`) {
                                    @if (label && label.value['key']
									&& label.value['value']) {
                                        <p-tag
                                                severity="secondary"
                                                value="{{ label.value['key'] ?? '' }}:{{ label.value['value'] ?? '' }}"
                                        />
                                    }
                                }
                            </div>
                        </div>
                        <div class="flex pt-6 justify-between">
                            <p-button
                                    severity="contrast"
                                    label="Back"
                                    icon="pi pi-arrow-left"
                                    iconPos="left"
                                    (onClick)="activateCallback(1)"
                            />
                            <p-button
                                    label="Next"
                                    icon="pi pi-arrow-right"
                                    iconPos="right"
                                    (onClick)="activateCallback(3)"
                            />
                        </div>
                    </form>
                </ng-template>
            </p-step-panel>
        </p-step-panels>
    </p-stepper>
</p-dialog>
